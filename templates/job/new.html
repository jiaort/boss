{% extends "base/base.html" %}
{% load bootstrap_pagination %}

{% block title %}
  <title>Job</title>
{% endblock %}

{% block content %}
  <div class="page-header">
    <h1><span class="text-muted font-weight-light"><i class="page-header-icon ion-ios-keypad"></i>职位信息 / </span>{% if job_info %}编辑职位{% else %}新建职位{% endif %}
    </h1>
  </div>

  <form id="job_form" action="" method="post">
    <div class="form-horizontal row">
    <div class="form-group col-sm-12">
      <label class="col-sm-3 control-label">*职位名称</label>
      <div class="col-sm-8">
        <input name="job_title" type="text" class="form-control" value="{{ job_info.job_title| default_if_none:'' }}">
      </div>
    </div>

    <div class="form-group col-sm-12">
      <label class="col-sm-3 control-label">*职位状态</label>
      <div class="col-sm-8">
        <select name="status" class="form-control status" data-allow-clear="true">
          <option></option>
          {% for item in job_status_option %}
            <option value={{ item.0 }} {% if item.0 == job_info.job_status %}selected{% endif %}>{{ item.1 }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="form-group col-sm-12">
      <label class="col-sm-3 control-label">*发布状态</label>
      <div class="col-sm-8">
        <select name="publish" class="form-control status" data-allow-clear="true">
          {% for item in publish_status_option %}
            <option value={{ item.0 }} {% if item.0 == job_info.publish_status %}selected{% endif %}>{{ item.1 }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

{#    <div class="form-group col-sm-12">#}
{#      <label class="col-sm-3 control-label">发布渠道</label>#}
{#      <div class="col-sm-8">#}
{#        <select name="channel" class="form-control channel" data-allow-clear="true">#}
{#          <option></option>#}
{#          {% for item in channel_option %}#}
{#            <option value={{ item.0 }} {% if item.0 == job_info.channel %}selected{% endif %}>{{ item.1 }}</option>#}
{#          {% endfor %}#}
{#        </select>#}
{#      </div>#}
{#    </div>#}

    <div class="form-group col-sm-12">
      <label class="col-md-3 control-label">*招聘类型</label>
      <div class="col-md-8">
        <label class="custom-control custom-radio radio-inline" for="social">
          <input type="radio" id="social" name="applicant_type" value=1 class="custom-control-input" {% if job_info == none or 1 == job_info.applicant_type %}checked{% endif %}>
          <span class="custom-control-indicator"></span>
          社会招聘
        </label>
        <label class="custom-control custom-radio radio-inline" for="campus">
          <input type="radio" id="campus" name="applicant_type" value=2 class="custom-control-input" {% if 2 == job_info.applicant_type %}checked{% endif %}>
          <span class="custom-control-indicator"></span>
          校园招聘
        </label>
      </div>
    </div>

    <div class="form-group col-sm-12">
      <label class="col-sm-3 control-label">*职能类型</label>
      <div class="col-sm-8">
        <select name="function_type" class="form-control salary" data-allow-clear="true">
          <option></option>
          {% for item in function_type_option %}
            <option value={{ item.0 }} {% if item.0 == job_info.function_type %}selected{% endif %}>{{ item.1 }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

{#    <div class="form-group col-sm-12">#}
{#      <label class="col-sm-3 control-label">工作类型</label>#}
{#      <div class="col-sm-4">#}
{#        <select name="job_type" class="form-control job-type" data-allow-clear="true">#}
{#          <option></option>#}
{#          {% for item in job_type_option %}#}
{#            <option value={{ item.0 }} {% if item.0 == job_info.job_type %}selected{% endif %}>{{ item.1 }}</option>#}
{#          {% endfor %}#}
{#        </select>#}
{#      </div>#}
{#      <div class="col-sm-4">#}
{#        <select name="sub_job_type" class="form-control sub-job-type" data-allow-clear="true">#}
{#          <option></option>#}
{#          {% for item in sub_job_type_option %}#}
{#            <option value={{ item.0 }} {% if item.0 == job_info.sub_job_type %}selected{% endif %}>{{ item.1 }}</option>#}
{#          {% endfor %}#}
{#        </select>#}
{#      </div>#}
{#    </div>#}

    <div class="form-group col-sm-12">
      <label class="col-sm-3 control-label">*工作地点</label>
      <div class="col-sm-4">
        <select name="work_place" class="form-control work-place" data-allow-clear="true">
          <option></option>
          {% for item in work_place_option %}
            <option value={{ item.0 }} {% if item.0 == job_info.work_place %}selected{% endif %}>{{ item.1 }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-sm-4">
        <select name="sub_work_place" class="form-control sub-work-place" data-allow-clear="true">
          <option></option>
          {% for item in sub_work_place_option %}
            <option value={{ item.0 }} {% if item.0 == job_info.sub_work_place %}selected{% endif %}>{{ item.1 }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

{#    <div class="form-group col-sm-12">#}
{#      <label class="col-sm-3 control-label">薪资待遇</label>#}
{#      <div class="col-sm-8">#}
{#        <select name="salary" class="form-control salary" data-allow-clear="true">#}
{#          <option></option>#}
{#          {% for item in salary_option %}#}
{#            <option value={{ item.0 }} {% if item.0 == job_info.salary %}selected{% endif %}>{{ item.1 }}</option>#}
{#          {% endfor %}#}
{#        </select>#}
{#      </div>#}
{#    </div>#}

    <div class="form-group col-sm-12">
      <label class="col-sm-3 control-label">*学历要求</label>
      <div class="col-sm-8">
        <select name="education" class="form-control education" data-allow-clear="true">
          <option></option>
          {% for item in education_option %}
            <option value={{ item.0 }} {% if item.0 == job_info.education %}selected{% endif %}>{{ item.1 }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="form-group col-sm-12">
      <label class="col-sm-3 control-label">*招聘人数</label>
      <div class="col-sm-8">
        <input name="number" type="text" class="form-control" value="{{ job_info.number| default_if_none:0 }}">
      </div>
    </div>

    <div class="form-group col-sm-12">
      <label class="col-sm-3 control-label">*工作经验</label>
      <div class="col-sm-8">
        <select name="experience" class="form-control experience" data-allow-clear="true">
          <option></option>
          {% for item in experience_option %}
            <option value={{ item.0 }} {% if item.0 == job_info.experience %}selected{% endif %}>{{ item.1 }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="form-group col-sm-12">
      <label class="col-sm-3 control-label">*投递邮箱</label>
      <div class="col-sm-8">
        <select name="email" class="form-control select2-info email" multiple>
          {% for item in email_option %}
            <option value={{ item.0 }} {% if item.0 in job_info.email %}selected{% endif %}>{{ item.1 }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

{#    <div class="form-group col-sm-12">#}
{#      <label class="col-sm-3 control-label">企业内部职位ID</label>#}
{#      <div class="col-sm-8">#}
{#        <input name="job_inner_id" type="text" class="form-control" value="{{ job_info.job_inner_id| default_if_none:'' }}">#}
{#      </div>#}
{#    </div>#}

    <div class="form-group col-sm-12">
      <label class="col-sm-3 control-label">*职位描述</label>
      <div class="col-sm-8">
        <textarea id="job_desc" name="job_desc">{{ job_info.job_desc| default_if_none:'职位描述' }}</textarea>
      </div>
    </div>

    <div class="form-group">
      <div class="col-md-offset-3 col-md-9">
        <a onclick="submit_job()" class="btn btn-primary">提交</a>&nbsp;&nbsp;
        <a herf="{% url 'job_list' %}" class="btn btn-primary">返回</a>
      </div>
    </div>
  </div>
  </form>

{% endblock %}

{% block script %}
  <script type="text/javascript">
  function submit_job() {
    let url = {% if job_info %}"{% url 'edit_job' job_info.id %}"{% else %}"{% url 'edit_new_job' %}"{% endif %};
    $.ajax({
      url: url,
      type: "POST",
      data: $('#job_form').serialize(),
      success: function (data) {
        if (data.code == ERROR_CODE.SUCCESS) {
          window.location.href = "{% url 'job_list' %}";
        } else if (data.code == ERROR_CODE.NOT_LOGIN) {
          window.location.href = "{% url 'sso_login' %}";
        } else {
          msg_info(data.msg_cn, 'danger');
        }
      }
    });
  }

  // -------------------------------------------------------------------------
  // Initialize Summernote

  $(function() {
    $("#job_desc").summernote({
      height: 200,
      toolbar: [
        ["parastyle", ["style"]],
        ["fontstyle", ["fontname", "fontsize"]],
        ["style", ["bold", "italic", "underline", "clear"]],
        {#["font", ["strikethrough", "superscript", "subscript"]],#}
        ["color", ["color"]],
        ["para", ["ul", "ol", "paragraph"]],
        ["height", ["height"]],
        {#["insert", ["picture", "link", "video", "table", "hr"]],#}
        ["history", ["undo", "redo"]],
        ["misc", ["codeview", "fullscreen"]],
        ["help", ["help"]]
      ],
    });
  });
  </script>

  <script>
    // -------------------------------------------------------------------------
    // Initialize Select2
    $(function() {
      $(".status").select2({
        placeholder: "请选择职位状态",
      });
    });

    $(function() {
      $(".channel").select2({
        placeholder: "请选择发布渠道",
      });
    });

    $(function() {
      $(".job-type").select2({
        placeholder: "请选择职位类型",
      });
    });

    $(function() {
      $(".sub-job-type").select2({
        placeholder: "请选择职位类型",
      });
    });

    $(function() {
      $(".work-place").select2({
        placeholder: "请选择工作地点",
      });
    });

    $(function() {
      $(".sub-work-place").select2({
        placeholder: "请选择工作地点",
      });
    });

    $(function() {
      $(".salary").select2({
        placeholder: "请选择职能类型",
      });
    });

    $(function() {
      $(".education").select2({
        placeholder: "请选择学历要求",
      });
    });

    $(function() {
      $(".experience").select2({
        placeholder: "请选择工作经验",
      });
    });

    $(function() {
      $(".email").select2({
        placeholder: "请选择投递邮箱",
      });
    });
  </script>
{% endblock %}
